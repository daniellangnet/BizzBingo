@using BizzBingo.Web.Areas.Wiki.Models
@using BizzBingo.Web.Models
@model DetailTermViewModel
@{
    ViewBag.Title = Model.Title;
}
<div class="row">
    <div class="span17">
        <h1>
            @Model.Title</h1>
    </div>
</div>
<div class="row">
    <div class="span11">
        <p>
            @Model.Description</p>
        <div class="well" style="padding: 14px 19px;">
            <input id="upvote" class="btn success" type="button" value="Like!" />
            <input id="downvote" class="btn danger" type="button" value="Don´t like!" />
        </div>
    </div>
    <div class="span5">
        <table class="zebra-striped">
            <thead>
                <tr>
                    <th colspan="2" style="width: 190px;">
                        <h3>
                            Stats</h3>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        Shared on
                    </td>
                    <td>
                        @Model.CreatedOn
                    </td>
                </tr>
                <tr>
                    <td>
                        Views
                    </td>
                    <td id="stateViews">
                        @Model.Views
                    </td>
                </tr>
                <tr>
                    <td>
                        Likes
                    </td>
                    <td id="stateUpvotes">
                        @Model.UpVotes
                    </td>
                </tr>
                <tr>
                    <td>
                        Don´t likes
                    </td>
                    <td id="stateDownvotes">
                        @Model.DownVotes
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="row">
    <div class="span11">
        <ul class="tabs">
            <li class="active"><a href="#all">All resources</a></li>
            <li><a href="#popular">Popularity</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="all">
                @foreach (Resource resource in Model.Resources)
                {
                    <div class="row">
                        <div class="span3">

                            <img class="thumbnail" src="http://image.thumber.de/?size=L&amp;url=@Url.Encode(resource.Url)" alt="">
                        </div>
                        <div class="span8">
                            <h4>
                                <a href="@resource.Url">@resource.Title</a> <small>&nbsp;</small>&nbsp;<span class="label">@resource.Upvotes -@resource.Downvotes</span></h4>
                            <p>@resource.Description</p>
                            <div class="well" style="padding: 14px 19px;">
                                <input id="upvote" class="btn" type="button" value="+">
                                <input id="downvote" class="btn" type="button" value="-">
                            </div>
                        </div>
                    </div>
                }
                <div class="row">
                    <div class="span11">
                        <legend>
                            <h3>
                                Add a new resource</h3>
                        </legend>
                            @using (Ajax.BeginForm("Resource", "Term", new AjaxOptions() { HttpMethod = "POST", OnComplete = "resourceAdded" }))
                            {
                                <fieldset>
                                    @Html.Hidden("TermId", Model.Id)
                                    <div class="clearfix">
                                        <label for="url">
                                            Url</label>
                                        <div class="input">
                                            <input class="xlarge" id="url" name="url" size="30" type="text">
                                        </div>
                                    </div>
                                    <div class="clearfix">
                                        <label for="title">
                                            Title</label>
                                        <div class="input">
                                            <input class="xlarge" id="title" name="title" size="30" type="text">
                                        </div>
                                    </div>
                                    <div class="clearfix">
                                        <label for="description">
                                            Description</label>
                                        <div class="input">
                                            <textarea class="xlarge" id="description" name="description" rows="3"></textarea>
                                            <span class="help-block">Short description...
                                            </span>
                                        </div>
                                    </div>
                                    <div class="actions">
                                        <input type="submit" class="btn primary" value="Save changes">&nbsp;
                                        <button type="reset" class="btn">
                                            Cancel</button>
                                    </div>
                                </fieldset>
                            }
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="popular">
                <img src="http://www.google.com/trends/viz?q=@Url.Encode(Model.Title)&geo=all&date=all&graph=gadget&width=640&height=190&hl=en" />
                <p><a href="http://www.google.com/insights/search/#q=@Url.Encode(Model.Title)&cmpt=date">Search Insight by Google</a></p>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="span11">
        <h2>
            Comments
        </h2>
        @{Html.RenderPartial("DisqusComments");}
    </div>
</div>
@section Scripts
{
    <script type="text/javascript">
        $(function () {
            $("#upvote").click(function () {
                $.ajax({
                    url: '@Url.Action("Upvote")?id=@Model.Id',
                    type: 'PUT',
                    success: function (result) {
                        refreshStats(result);
                    }
                });
            });

            $("#downvote").click(function () {
                $.ajax({
                    url: '@Url.Action("Downvote")?id=@Model.Id',
                    type: 'PUT',
                    success: function (result) {
                        refreshStats(result);
                    }
                });
            });

            $("#url").blur(function () {
                $.ajax({
                    url: '@Url.Action("Lookup")?url=' + $("#url").val(),
                    type: 'GET',
                    success: function (result) {
                        if(result != false) {
                            $("#title").val(result.Title);
                            $("#description").val(result.Description);
                        }
                    }
                });
            });

            $('.tabs').tabs();
        });

        function refreshStats(result) {
            $("#stateViews").html(result.Views);
            $("#stateDownvotes").html(result.DownVotes);
            $("#stateUpvotes").html(result.UpVotes);
        }

        function resourceAdded() {
            window.location.reload();
        }
    </script>
}
